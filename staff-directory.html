<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Directory - UKBRUM</title>
    <link rel="icon" type="image/png" href="images/logo.png">
    <link rel="shortcut icon" type="image/png" href="images/logo.png">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/info-pages.css">
    <link rel="stylesheet" href="css/accessibility.css">
    <link rel="stylesheet" href="css/announcements.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="js/maintenance-check-simple.js"></script>
    <script src="js/script.js" defer></script>
    <script src="js/accessibility.js" defer></script>
    <script src="js/announcements.js" defer></script>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <a href="index.html">
                    <img src="images/logo.png" alt="UKBRUM Logo">
                    <h1><span class="full-name">United Kingdom Birmingham Roleplay</span><span class="short-name">UKBRUM</span></h1>
                </a>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="index.html#about">About</a></li>
                    <li><a href="index.html#departments">Departments</a></li>
                    <li><a href="departments/divisions.html">Divisions</a></li>
                    <li><a href="info.html">Info</a></li>
                    <li><a href="index.html#join">Join Us</a></li>
                </ul>
            </nav>

            <div class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </header>

    <section class="info-hero staff-directory">
        <div class="container">
            <h1>Staff Directory</h1>
            <p>Meet our dedicated team members</p>
        </div>
    </section>

    <section class="info-section">
        <div class="container">
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="staffSearch" placeholder="Search staff members...">
                    <i class="fas fa-search"></i>
                </div>
                <div class="filter-buttons">
                    <button class="filter-btn active" data-role="all">All Senior High Ranking Staff</button>
                    <button class="filter-btn" data-role="Founder">Founders</button>
                    <button class="filter-btn" data-role="Co-Founder">Co-Founders</button>
                    <button class="filter-btn" data-role="Execuative Assistant">Execuative Assistant</button>
                    <button class="filter-btn" data-role="Directorate">Directorate</button>
                </div>
            </div>
            
            <div class="staff-grid" id="staffGrid">
                <div class="loading">Loading staff directory...</div>
            </div>
        </div>
    </section>

<div id="footer"></div>

<script>
  fetch("footer.html")
    .then(response => response.text())
    .then(data => {
      // Inject footer HTML
      document.getElementById("footer").innerHTML = data;

      // Update year dynamically
      document.getElementById("year").textContent = new Date().getFullYear();

      // Update "last updated" in UK format
      const lastUpdatedEl = document.getElementById("last-updated");
      if (lastUpdatedEl) {
        lastUpdatedEl.textContent = new Date(document.lastModified)
          .toLocaleDateString("en-GB", {
            day: "2-digit",
            month: "2-digit",
            year: "numeric"
          });
      }
    })
    .catch(error => console.error("Error loading footer:", error));
</script>

    <script>
        let allStaff = [];
        let filteredStaff = [];

        document.addEventListener('DOMContentLoaded', async function() {
            await loadStaffDirectory();
            setupSearch();
            setupFilters();
        });

        async function loadStaffDirectory() {
            try {
                const response = await fetch('data/staff-directory.json');
                const data = await response.json();
                allStaff = data.staff;
                filteredStaff = [...allStaff];
                displayStaff(filteredStaff);
            } catch (error) {
                document.getElementById('staffGrid').innerHTML = '<div class="error-message">Failed to load staff directory</div>';
            }
        }

        function displayStaff(staff) {
            const grid = document.getElementById('staffGrid');
            const container = document.querySelector('.info-section .container');
            
            // Remove existing past staff section
            const existingPastSection = container.querySelector('.past-staff-section');
            if (existingPastSection) {
                existingPastSection.remove();
            }
            
            if (staff.length === 0) {
                grid.innerHTML = '<div class="no-results">No staff members found</div>';
                return;
            }

            // Separate current and past staff
            const currentStaff = staff.filter(member => member.employed !== false);
            const pastStaff = allStaff.filter(member => member.employed === false);

            grid.innerHTML = currentStaff.map(member => {
                const roleClass = member.role.toLowerCase().replace(/\s+/g, '-').replace('&', '');
                
                // If Website Developer, render a special banner card
                if (member.role === "Website Developer") {
                    return `
                        <div class="staff-card website-developer" data-role="${member.role}">
                            <div class="dev-banner">
                                <img class="dev-avatar" src="${member.avatar}" alt="${member.name}" onerror="this.src='images/default-avatar.png'">
                                <div class="dev-info">
                                    <h3>${member.name}</h3>
                                    <span class="dev-role">${member.role}</span>
                                    <p class="dev-statement"><span class="statement-text">${member.statement.length > 170 ? member.statement.substring(0, 170) + '...' : member.statement}</span>
                                    ${member.statement.length > 170 ? `<br><button class="read-more-btn dev-read-more" onclick="toggleStatement(this, '${member.statement.replace(/'/g, "\\'")}')">Read More</button>` : ''}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }

                // If Founder, render a special banner card
                if (member.role === "Founder") {
                    return `
                        <div class="staff-card founder" data-role="${member.role}">
                            <div class="founder-banner">
                                <img class="founder-avatar" src="${member.avatar}" alt="${member.name}" onerror="this.src='images/default-avatar.png'">
                                <div class="founder-info">
                                    <h3>${member.name}</h3>
                                    <div class="role-badge founder">${member.role}</div>
                                    <div class="staff-statement">
                                        <p><i class="fas fa-quote-left"></i> <span class="statement-text">${member.statement.length > 170 ? member.statement.substring(0, 170) + '...' : member.statement}</span></p>
                                        ${member.statement.length > 170 ? `<button class="read-more-btn" onclick="toggleStatement(this, '${member.statement.replace(/'/g, "\\'")}')">Read More</button>` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }

                // Default staff card
                return `
                    <div class="staff-card ${roleClass}" data-role="${member.role}">
                        <div class="staff-avatar">
                            <img src="${member.avatar}" alt="${member.name}" onerror="this.src='images/default-avatar.png'">
                            <div class="role-badge ${roleClass}">${member.role}</div>
                        </div>
                        <div class="staff-info">
                            <h3>${member.name}</h3>
                            <div class="staff-statement">
                                <p><i class="fas fa-quote-left"></i> <span class="statement-text">${member.statement.length > 170 ? member.statement.substring(0, 170) + '...' : member.statement}</span></p>
                                ${member.statement.length > 170 ? `<button class="read-more-btn" onclick="toggleStatement(this, '${member.statement.replace(/'/g, "\\'")}')">Read More</button>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Add past staff section if there are any and we're showing all staff
            if (pastStaff.length > 0 && (filteredStaff === allStaff || filteredStaff.some(member => member.employed === false))) {
                const pastSection = document.createElement('div');
                pastSection.className = 'past-staff-section';
                pastSection.innerHTML = `
                    <h2 class="past-staff-title">Past Leadership</h2>
                    <div class="past-staff-grid">
                        ${pastStaff.map(member => `
                            <div class="past-staff-card" data-role="${member.role}">
                                <div class="past-staff-avatar">
                                    <img src="${member.avatar}" alt="${member.name}" onerror="this.src='images/default-avatar.png'">
                                    <div class="past-role-badge">${member.role}</div>
                                </div>
                                <div class="past-staff-info">
                                    <h4>${member.name}</h4>
                                    <p class="past-specialization">${member.specialization}</p>
                                    <div class="past-skill-tags">
                                        ${(member.skills || []).map(skill => 
                                            `<span class="past-skill-tag">${skill}</span>`
                                        ).join('')}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(pastSection);
            }
        }

        function setupSearch() {
            const searchInput = document.getElementById('staffSearch');
            searchInput.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                filteredStaff = allStaff.filter(member => 
                    member.name.toLowerCase().includes(query) ||
                    member.specialization.toLowerCase().includes(query) ||
                    member.role.toLowerCase().includes(query) ||
                    member.status.toLowerCase().includes(query)
                );
                displayStaff(filteredStaff);
            });
        }

        function setupFilters() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    filterButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const role = this.dataset.role;
                    if (role === 'all') {
                        filteredStaff = [...allStaff];
                    } else {
                        filteredStaff = allStaff.filter(member => member.role === role);
                    }
                    displayStaff(filteredStaff);
                    document.getElementById('staffSearch').value = '';
                });
            });
        }

        function toggleStatement(button, fullStatement) {
            const statementText = button.parentElement.querySelector('.statement-text');
            const isExpanded = button.textContent === 'Read Less';
            
            if (isExpanded) {
                statementText.textContent = fullStatement.substring(0, 170) + '...';
                button.textContent = 'Read More';
            } else {
                statementText.textContent = fullStatement;
                button.textContent = 'Read Less';
            }
        }
    </script>
</body>
</html>